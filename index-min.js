/*! @lfp/unit-test-0.0.1 by da宗熊 MIT https://github.com/linfenpan/unit-test#readme*/
!function(t,n){"function"==typeof define?define.amd?define(n):define(function(t,i,o){o.exports=n()}):"object"==typeof exports?module.exports=n():t.UnitTest=n()}(this,function(t){"use strict";function n(){}function i(t){return Object.prototype.toString.call(t).split(" ")[1].slice(0,-1).toLowerCase()}function o(t){return"function"===i(t)}function e(t){return"string"===i(t)}function r(t,n){for(var i in t)t.hasOwnProperty(i)&&n.call(t,i,t[i])}function c(t,n){return r(n,function(n,i){t[n]=i}),t}function s(t){function n(){var t=i.shift();t?o(t,function(){n()}):e&&e()}t=t||{};var i=t.list,o=t.next,e=t.end;n()}function u(t,n){return new Array(n||1).join("  ")+t}function f(t){var n=1,i=function(){var i=this;i.index||(i.index=n),n++,t.apply(i,arguments),n--};return i}function a(t){var n=1e4,i=function(){var i=this;i.id||(i.id=n++),t.apply(i,arguments)};return i}function p(t){return this instanceof p?void this.init(t):new p(t)}function l(t,n){if(e(n[0])===!1)throw t+" first argument should be String";if(o(n[1])===!1)throw t+" second argument should be Function"}function d(t,n){s({list:t.slice(0),next:function(t,n){t(n)},end:function(){n()}})}var h={log:function(t){console.log("%c"+t,"color: orangered")},error:function(t){console.error(t)},success:function(t){console.log("%c"+t,"color: green")}},g=function(){var t=[];return function(n,i){return function(){var o=c({},t[0]||{});t.length>0?t[0]=o:t.unshift(o);var e=c({},i);e=c(e,o),t.unshift(e),n.apply(e,arguments),t.shift()}}}(),v=5e3;return c(p.prototype,{init:function(t){var n=this;n.descriptMap={},n.options={timeout:v,afters:[],befores:[]},c(n.options,t||{}),n.logger=h,n.initDescript(),n.initIt(),n.initRun(),n.initTimeout(),n.initBeforeAndAfter()},initDescript:function(){var t=this,n=function(t,n){var i=this,o=i.ctx;l("descript",arguments),i.descriptor=c(o.getDescriptor(i.id),{index:i.index,desc:t}),n()};t.descript=g(a(f(n)),{ctx:t})},initIt:function(){var t=this,n=function(t,n){var i=this,o=(i.ctx,i.descriptor);o&&(l("it",arguments),o.runs.push({text:t,run:n}))};t.it=g(n)},initRun:function(){var t=this,n=t.options;t.run=function(){var i=t.logger,o=[];r(t.descriptMap,function(t,n){o.push(n)}),s({list:o,next:function(o,e){var r=o.desc;i.log("START: "+r),d(n.befores,function(){t.sequentTest(o,function(){i.log("END: "+r),i.log("  "),d(n.afters,e)})})},end:function(){i.success("all pass (●'◡'●)")}})}},sequentTest:function(t,i){function o(){clearTimeout(r)}var r,c=this,f=t.index+1,a=t.timeout,p=c.logger,l=t.runs;s({list:l.slice(0),next:function(i,c){var s=i.run,l=i.text;p.log(u(l,f)),o(),r=setTimeout(function(){c=n,p.error(u("timeout",f))},a);try{d(t.befores,function(){s(function(){p.success(u("success",f+1)),d(t.afters,function(){c()})})})}catch(t){if(o(),!e(t))throw t;p.error(u(t,f))}},end:function(){o(),i()}})},initTimeout:function(){var t=this,n=function(n){var i=this.descriptor;i||(i=t.options),i.timeout=n||v};t.timeout=g(n)},initBeforeAndAfter:function(){function t(t,i){if(o(i)){var e=this.descriptor;e||(e=n.options),e[t].push(i)}}var n=this,i=function(n){t.call(this,"befores",n)},e=function(n){t.call(this,"afters",n)};n.after=g(e),n.before=g(i)},getDescriptor:function(t){var n=this.options,i={id:t,desc:"",runs:[],index:0,afters:[],befores:[],timeout:n.timeout},o=this.descriptMap;return o[t]?o[t]:o[t]=i},setLogger:function(t){c(this.logger,t)}}),p});