/*! unitTest.js-0.0.4 by da宗熊 MIT https://github.com/linfenpan/unit-test#readme*/
!function(t,n){"function"==typeof define?define.amd?define(n):define(function(t,i,e){e.exports=n()}):"object"==typeof exports?module.exports=n():t.UnitTest=n()}(this,function(t){"use strict";function n(t){return Object.prototype.toString.call(t).split(" ")[1].slice(0,-1).toLowerCase()}function i(t){return"function"===n(t)}function e(t){return"string"===n(t)}function o(t,n){for(var i in t)t.hasOwnProperty(i)&&n.call(t,i,t[i])}function r(t,n){return o(n,function(n,i){t[n]=i}),t}function u(t){function n(){var t=i.shift();t?e(t,function(){n()}):o&&o()}t=t||{};var i=t.list,e=t.next,o=t.end;n()}function s(t,n){return new Array(n||1).join("  ")+t}function c(t){var n=1,i=function(){var i=this;i.index||(i.index=n),n++;try{t.apply(i,arguments)}finally{n--}};return i}function f(t){var n=1e4,i=function(){var i=this;i.id||(i.id=n++),t.apply(i,arguments)};return i}function a(t){return this instanceof a?void this.init(t):new a(t)}function l(t,n){if(e(n[0])===!1)throw t+" first argument should be String";if(i(n[1])===!1)throw t+" second argument should be Function"}function p(t,n){u({list:t.slice(0),next:function(t,n){t(n)},end:function(){n()}})}var d={log:function(t){console.log(t)},error:function(t){console.error(t)},success:function(t){console.log(t)}},h=function(){var t=[];return function(n,i){return function(){var e=r({},t[0]||{});t.length>0?t[0]=e:t.unshift(e);var o=r({},i);o=r(o,e),t.unshift(o);try{n.apply(o,arguments)}finally{t.shift()}}}}(),v=function(){var t={};return function(n,i){return function(){if(t[i])throw'"'+i+'" can not be embedded';t[i]=1;try{n.apply(this,arguments)}finally{t[i]=0}}}}(),g=5e3;return r(a.prototype,{init:function(t){var n=this;n.descriptMap={},n.options={timeout:g,afters:[],befores:[]},r(n.options,t||{}),n.logger=d,n.initDescript(),n.initIt(),n.initRun(),n.initTimeout(),n.initBeforeAndAfter()},initDescript:function(){var t=this,n=function(t,n){var i=this,e=i.ctx;l("descript",arguments),i.descriptor=r(e.getDescriptor(i.id),{index:i.index,desc:t}),n()};t.descript=h(f(c(v(n,"descript"))),{ctx:t})},initIt:function(){var t=this,n=function(t,n){var i=this,e=(i.ctx,i.descriptor);e&&(l("it",arguments),e.runs.push({text:t,run:n}))};t.it=h(v(n,"it"))},initRun:function(){var t=this,n=t.options;t.run=function(){var i=t.logger,e=[];o(t.descriptMap,function(t,n){e.push(n)}),u({list:e,next:function(e,o){var r=e.desc;p(n.befores,function(){i.log("START: "+r),t.sequentTest(e,function(){i.log("END: "+r),i.log("  "),p(n.afters,o)})})},end:function(){i.success("all pass (●'◡'●)")}})}},sequentTest:function(t,n){function i(){clearTimeout(e)}var e,o=this,r=t.index+1,c=t.timeout,f=o.logger,a=t.runs;u({list:a.slice(0),next:function(n,o){var u=n.run,a=n.text;i(),e=setTimeout(function(){throw"timeout"},c),p(t.befores,function(){f.log(s(a,r));try{u(function(){i(),f.success(s("success",r+1)),p(t.afters,function(){o()})})}catch(t){throw i(),t}})},end:function(){i(),n()}})},initTimeout:function(){var t=this,n=function(n){var i=this.descriptor;i||(i=t.options),i.timeout=n||g};t.timeout=h(n)},initBeforeAndAfter:function(){var t=this,n=function(n,e){if(i(e)){var o=this.descriptor;o||(o=t.options),o[n].push(e)}},e=function(t){n.call(this,"befores",t)},o=function(t){n.call(this,"afters",t)};t.after=h(o),t.before=h(e)},getDescriptor:function(t){var n=this.options,i={id:t,desc:"",runs:[],index:0,afters:[],befores:[],timeout:n.timeout},e=this.descriptMap;return e[t]?e[t]:e[t]=i},setLogger:function(t){r(this.logger,t)}}),a});